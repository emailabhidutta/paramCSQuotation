<div [formGroup]="parentForm">
  <div formArrayName="details">
    <div [formGroupName]="detailIndex">
      <div formArrayName="items">
        <div *ngFor="let item of items.controls; let i = index" [formGroupName]="i" class="line-item">
          <div class="form-row">
            <div class="form-group">
              <label for="MaterialNumber-{{i}}">Material Number:</label>
              <input id="MaterialNumber-{{i}}" formControlName="MaterialNumber"
                     [ngbTypeahead]="searchMaterials"
                     [resultFormatter]="formatMaterialResult"
                     [inputFormatter]="formatMaterialResult"
                     (selectItem)="onMaterialSelected($event, i)"
                     required>
            </div>
            <div class="form-group">
              <label for="MaterialDescription-{{i}}">Description:</label>
              <input id="MaterialDescription-{{i}}" formControlName="MaterialDescription" required>
            </div>
            <div class="form-group">
              <label for="PricePer-{{i}}">Price Per:</label>
              <input id="PricePer-{{i}}" type="number" formControlName="PricePer" (change)="calculateOrderValue(i)" required>
            </div>
            <div class="form-group">
              <label for="Per-{{i}}">Per:</label>
              <input id="Per-{{i}}" type="number" formControlName="Per" required>
            </div>
            <div class="form-group">
              <label for="UnitOfMeasure-{{i}}">UoM:</label>
              <input id="UnitOfMeasure-{{i}}" formControlName="UnitOfMeasure" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="OrderQuantity-{{i}}">Quantity:</label>
              <input id="OrderQuantity-{{i}}" type="number" formControlName="OrderQuantity" (change)="calculateOrderValue(i)" required>
            </div>
            <div class="form-group">
              <label for="DiscountValue-{{i}}">Discount:</label>
              <input id="DiscountValue-{{i}}" type="number" formControlName="DiscountValue" (change)="calculateOrderValue(i)" required>
            </div>
            <div class="form-group">
              <label for="SurchargeValue-{{i}}">Surcharge:</label>
              <input id="SurchargeValue-{{i}}" type="number" formControlName="SurchargeValue" (change)="calculateOrderValue(i)" required>
            </div>
            <div class="form-group">
              <label for="OrderValue-{{i}}">Order Value:</label>
              <input id="OrderValue-{{i}}" type="number" formControlName="OrderValue" readonly>
            </div>
          </div>
          <button type="button" (click)="removeItem(i)" class="btn btn-danger">Remove Item</button>
        </div>
      </div>
      <button type="button" (click)="addItem()" class="btn btn-primary">Add Item</button>
    </div>
  </div>
</div>
